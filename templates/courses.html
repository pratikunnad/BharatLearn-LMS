{% extends "base.html" %}
{% block content %}

<style>
/* PAGE */
h2 {
    margin-bottom: 15px;
    color: #0a3d62;
}

/* SEARCH & FILTERS */
form {
    margin-bottom: 15px;
}

input[type="text"], select {
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
    min-width: 180px;
}

button {
    padding: 10px 18px;
    border: none;
    border-radius: 6px;
    background: #0a3d62;
    color: #fff;
    font-weight: 600;
    cursor: pointer;
}

button:hover {
    opacity: 0.9;
}

.clear-btn {
    margin-left: 10px;
    text-decoration: none;
    color: #0a3d62;
    font-weight: 500;
}

.filters {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
}

/* COURSE GRID */
.course-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 25px;
    margin-top: 30px;
}

/* COURSE CARD */
.course-card {
    background: #ffffff;
    border-radius: 10px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    padding: 18px;
    transition: transform 0.25s, box-shadow 0.25s;
}

.course-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 16px 35px rgba(0,0,0,0.12);
}

.course-card img {
    width: 100%;
    height: 150px;
    object-fit: cover;
    border-radius: 8px;
    margin-bottom: 12px;
}

.course-card h3 {
    color: #0a3d62;
    margin-bottom: 6px;
}

.course-card p {
    font-size: 14px;
    color: #555;
    margin-bottom: 12px;
}

/* BADGES */
.badge {
    display: inline-block;
    padding: 5px 10px;
    font-size: 12px;
    border-radius: 20px;
    background: #eef4ff;
    color: #0a3d62;
    margin-right: 5px;
    margin-bottom: 8px;
}

/* BUTTONS */
.btn {
    width: 100%;
    padding: 10px;
    border-radius: 6px;
    font-weight: 600;
    margin-top: 10px;
}

.btn-primary {
    background: #1e90ff;
    color: #fff;
}

.btn-success {
    background: #2ecc71;
    color: #fff;
}

/* PAGINATION */
.pagination {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 40px 0;
}

.pagination a {
    padding: 8px 16px;
    background: #0a3d62;
    color: #fff;
    border-radius: 6px;
    text-decoration: none;
}

.pagination span {
    padding: 8px 16px;
    font-weight: 600;
}

/* MOBILE */
@media (max-width: 600px) {
    .filters {
        flex-direction: column;
    }
}
</style>

<h2>Explore Courses</h2>

<!-- Search -->
<form method="get" action="{{ url_for('courses') }}">
    <input type="text" name="search" placeholder="Search courses..." value="{{ search }}">
    <button type="submit">Search</button>
    <a href="{{ url_for('courses') }}" class="clear-btn">Clear</a>
</form>

<!-- Filters -->
<form method="get" action="{{ url_for('courses') }}" class="filters">
    <select name="programming_language">
        <option value="">All Languages</option>
        <option value="Python" {{ 'selected' if selected_programming_language == 'Python' }}>Python</option>
        <option value="Java" {{ 'selected' if selected_programming_language == 'Java' }}>Java</option>
        <option value="C++" {{ 'selected' if selected_programming_language == 'C++' }}>C++</option>
    </select>

    <select name="difficulty">
        <option value="">All Levels</option>
        <option value="Beginner" {{ 'selected' if selected_difficulty == 'Beginner' }}>Beginner</option>
        <option value="Intermediate" {{ 'selected' if selected_difficulty == 'Intermediate' }}>Intermediate</option>
        <option value="Advance" {{ 'selected' if selected_difficulty == 'Advance' }}>Advance</option>
    </select>

    <select name="source">
        <option value="">All Sources</option>
        <option value="YouTube" {{ 'selected' if selected_source == 'YouTube' }}>YouTube</option>
        <option value="Udemy" {{ 'selected' if selected_source == 'Udemy' }}>Udemy</option>
        <option value="Coursera" {{ 'selected' if selected_source == 'Coursera' }}>Coursera</option>
        <option value="FreeCodeCamp" {{ 'selected' if selected_source == 'FreeCodeCamp' }}>FreeCodeCamp</option>
    </select>

    <select name="sort">
        <option value="newest" {{ 'selected' if sort == 'newest' }}>Newest</option>
        <option value="popular" {{ 'selected' if sort == 'popular' }}>Most Popular</option>
    </select>

    <button type="submit">Apply</button>
</form>

<hr>

<!-- COURSES -->
<div class="course-container">
{% for course in courses %}
    <div class="course-card">
        {% if course.image_url %}
            {% if course.image_url.startswith('http') %}
                <img src="{{ course.image_url }}">
            {% else %}
                <img src="{{ url_for('static', filename='images/' ~ course.image_url) }}">
            {% endif %}
        {% else %}
            <img src="{{ url_for('static', filename='images/default-course.png') }}">
        {% endif %}

        <h3>{{ course.title }}</h3>
        <p>{{ course.description }}</p>

        <span class="badge">{{ course.programming_language }}</span>
        <span class="badge">{{ course.difficulty }}</span>
        <span class="badge">{{ course.source }}</span>

        {% if course.is_enrolled %}
            <button class="btn btn-success" disabled>Enrolled</button>
        {% else %}
            <button class="btn btn-primary enroll-btn" data-course-id="{{ course.id }}">Enroll</button>
        {% endif %}
    </div>
{% endfor %}
</div>

<!-- PAGINATION -->
<div class="pagination">
{% if page > 1 %}
    <a href="{{ url_for('courses', page=page-1, search=search, programming_language=selected_programming_language, difficulty=selected_difficulty, source=selected_source) }}">Previous</a>
{% endif %}

<span>Page {{ page }} of {{ total_pages }}</span>

{% if page < total_pages %}
    <a href="{{ url_for('courses', page=page+1, search=search, programming_language=selected_programming_language, difficulty=selected_difficulty, source=selected_source) }}">Next</a>
{% endif %}
</div>

{% if session.get("role") == "student" %}
    <a href="/student/dashboard">⬅ Back to Dashboard</a>
{% elif session.get("role") == "admin" %}
    <a href="/admin/dashboard">⬅ Back to Dashboard</a>
{% else %}
    <a href="/">⬅ Back to Home</a>
{% endif %}

<!-- AJAX ENROLL (UNCHANGED) -->
<script>
document.querySelectorAll(".enroll-btn").forEach(btn => {
    btn.addEventListener("click", function () {
        const courseId = this.dataset.courseId;
        fetch(`/enroll/${courseId}`, { method: "POST" })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert("You have successfully enrolled in this course!");
                    window.location.href = "/my-enrollments";
                }
            });
    });
});
</script>

{% endblock %}