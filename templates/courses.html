{% extends "base.html" %}
{% block content %}

<style>
/* ================= PAGE TITLE ================= */
.page-title {
    font-size: 28px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 20px;
}

/* ================= FILTER BAR ================= */
.filter-bar {
    position: sticky;
    top: 80px;
    z-index: 20;
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(10px);
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    margin-bottom: 30px;
}

body.dark .filter-bar {
    background: rgba(2,6,23,0.9);
}

.filter-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
}

/* INPUTS */
.filter-grid input,
.filter-grid select {
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid #d1d5db;
    font-size: 14px;
    min-width: 170px;
}

/* BUTTONS */
.filter-grid button {
    padding: 10px 20px;
    border-radius: 8px;
    border: none;
    background: var(--primary);
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: 0.2s;
}

.filter-grid button:hover {
    opacity: 0.9;
}

.clear-btn {
    color: var(--primary);
    font-weight: 500;
    text-decoration: none;
    align-self: center;
}

/* ================= COURSE GRID ================= */
.course-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 28px;
}

/* ================= COURSE CARD ================= */
.course-card {
    background: rgba(255,255,255,0.85);
    backdrop-filter: blur(12px);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 12px 30px rgba(0,0,0,0.1);
    transition: transform 0.3s, box-shadow 0.3s;
}

body.dark .course-card {
    background: rgba(2,6,23,0.9);
}

.course-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 18px 40px rgba(0,0,0,0.18);
}

/* IMAGE */
.course-card img {
    width: 100%;
    height: 170px;
    object-fit: cover;
}

/* CONTENT */
.course-content {
    padding: 18px;
}

.course-content h3 {
    font-size: 18px;
    margin-bottom: 8px;
    color: var(--primary);
}

.course-content p {
    font-size: 14px;
    opacity: 0.85;
    margin-bottom: 12px;
}

/* BADGES */
.badges {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 14px;
}

.badge {
    padding: 5px 12px;
    font-size: 12px;
    border-radius: 20px;
    background: #e0ecff;
    color: var(--primary);
    font-weight: 500;
}

/* ACTION BUTTON */
.course-card button {
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    font-weight: 600;
    border: none;
    cursor: pointer;
}

.btn-primary {
    background: #2563eb;
    color: white;
}

.btn-success {
    background: #16a34a;
    color: white;
}

/* ================= PAGINATION ================= */
.pagination {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 50px 0 30px;
}

.pagination a,
.pagination span {
    padding: 10px 18px;
    border-radius: 8px;
    background: var(--primary);
    color: white;
    text-decoration: none;
    font-weight: 500;
}

/* ================= RESPONSIVE ================= */
@media (max-width: 640px) {
    .filter-grid {
        flex-direction: column;
    }
}
</style>

<h2 class="page-title">Explore Courses</h2>

<!-- ================= FILTER BAR ================= -->
<form method="get" action="{{ url_for('courses') }}" class="filter-bar">
    <div class="filter-grid">
        <input type="text" name="search" placeholder="Search courses..." value="{{ search }}">

        <select name="programming_language">
            <option value="">All Languages</option>
            <option value="Python" {{ 'selected' if selected_programming_language == 'Python' }}>Python</option>
            <option value="Java" {{ 'selected' if selected_programming_language == 'Java' }}>Java</option>
            <option value="C++" {{ 'selected' if selected_programming_language == 'C++' }}>C++</option>
        </select>

        <select name="difficulty">
            <option value="">All Levels</option>
            <option value="Beginner" {{ 'selected' if selected_difficulty == 'Beginner' }}>Beginner</option>
            <option value="Intermediate" {{ 'selected' if selected_difficulty == 'Intermediate' }}>Intermediate</option>
            <option value="Advanced" {{ 'selected' if selected_difficulty == 'Advanced' }}>Advanced</option>
        </select>

        <select name="source">
            <option value="">All Sources</option>
            <option value="YouTube" {{ 'selected' if selected_source == 'YouTube' }}>YouTube</option>
            <option value="Udemy" {{ 'selected' if selected_source == 'Udemy' }}>Udemy</option>
            <option value="Coursera" {{ 'selected' if selected_source == 'Coursera' }}>Coursera</option>
            <option value="FreeCodeCamp" {{ 'selected' if selected_source == 'FreeCodeCamp' }}>FreeCodeCamp</option>
        </select>

        <select name="sort">
            <option value="newest" {{ 'selected' if sort == 'newest' }}>Newest</option>
            <option value="popular" {{ 'selected' if sort == 'popular' }}>Most Popular</option>
        </select>

        <button type="submit">Apply</button>
        <a href="{{ url_for('courses') }}" class="clear-btn">Clear</a>
    </div>
</form>

<!-- ================= COURSES ================= -->
<div class="course-container">
{% for course in courses %}
    <div class="course-card">

        {% if course.image_url %}
            {% if course.image_url.startswith('http') %}
                <img src="{{ course.image_url }}">
            {% else %}
                <img src="{{ url_for('static', filename='images/' ~ course.image_url) }}">
            {% endif %}
        {% else %}
            <img src="{{ url_for('static', filename='images/default-course.png') }}">
        {% endif %}

        <div class="course-content">
            <h3>{{ course.title }}</h3>
            <p>{{ course.description }}</p>

            <div class="badges">
                <span class="badge">{{ course.programming_language }}</span>
                <span class="badge">{{ course.difficulty }}</span>
                <span class="badge">{{ course.source }}</span>
            </div>

            {% if course.is_enrolled %}
                <button class="btn-success" disabled>Enrolled</button>
            {% else %}
                <button class="btn-primary enroll-btn" data-course-id="{{ course.id }}">Enroll</button>
            {% endif %}
        </div>
    </div>
{% endfor %}
</div>

<!-- ================= PAGINATION ================= -->
<div class="pagination">
{% if page > 1 %}
    <a href="{{ url_for('courses', page=page-1, search=search, programming_language=selected_programming_language, difficulty=selected_difficulty, source=selected_source) }}">Previous</a>
{% endif %}

<span>Page {{ page }} of {{ total_pages }}</span>

{% if page < total_pages %}
    <a href="{{ url_for('courses', page=page+1, search=search, programming_language=selected_programming_language, difficulty=selected_difficulty, source=selected_source) }}">Next</a>
{% endif %}
</div>

<!-- ================= ENROLL AJAX ================= -->
<script>
document.querySelectorAll(".enroll-btn").forEach(btn => {
    btn.addEventListener("click", function () {
        fetch(`/enroll/${this.dataset.courseId}`, { method: "POST" })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    window.location.href = "/my-enrollments";
                }
            });
    });
});
</script>

{% endblock %}
