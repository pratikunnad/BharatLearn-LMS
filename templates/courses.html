{% extends "base.html" %}
{% block content %}

<style>
/* ================= PAGE HEADER ================= */
.page-title {
    font-size: 30px;
    font-weight: 800;
    margin-bottom: 10px;
    color: var(--primary);
}
.page-subtitle {
    color: var(--muted-light);
    margin-bottom: 30px;
}
body.dark .page-subtitle {
    color: var(--muted-dark);
}

/* ================= FILTER BAR ================= */
.filter-bar {
    position: sticky;
    top: 80px;
    z-index: 50;
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(12px);
    border-radius: 14px;
    padding: 18px;
    box-shadow: 0 12px 30px rgba(0,0,0,0.1);
    margin-bottom: 35px;
}
body.dark .filter-bar {
    background: rgba(2,6,23,0.9);
}

.filter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 14px;
}

.filter-grid input,
.filter-grid select {
    padding: 11px 14px;
    border-radius: 10px;
    border: 1px solid var(--border-light);
    font-size: 14px;
    background: transparent;
    color: inherit;
}
body.dark .filter-grid input,
body.dark .filter-grid select {
    border-color: var(--border-dark);
}

.filter-grid button {
    background: linear-gradient(135deg, #2563eb, #0a3d62);
    color: #fff;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
}

.clear-btn {
    text-align: center;
    font-size: 14px;
    font-weight: 600;
    color: var(--primary);
    text-decoration: none;
    padding-top: 8px;
}

/* ================= COURSE GRID ================= */
.course-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 30px;
}

/* ================= COURSE CARD ================= */
.course-card {
    background: rgba(255,255,255,0.88);
    backdrop-filter: blur(12px);
    border-radius: 18px;
    overflow: hidden;
    box-shadow: 0 14px 35px rgba(0,0,0,0.12);
    transition: transform .3s ease, box-shadow .3s ease;
}
body.dark .course-card {
    background: rgba(2,6,23,0.9);
}

.course-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 45px rgba(0,0,0,0.2);
}

/* IMAGE */
.course-card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
}

/* CONTENT */
.course-content {
    padding: 20px;
}

.course-content h3 {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 8px;
}

.course-content p {
    font-size: 14px;
    opacity: 0.85;
    margin-bottom: 14px;
}

/* BADGES */
.badges {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 18px;
}
.badge {
    padding: 5px 12px;
    font-size: 12px;
    border-radius: 999px;
    background: #e0ecff;
    color: var(--primary);
    font-weight: 600;
}
body.dark .badge {
    background: #1e293b;
}

/* BUTTONS */
.course-card button {
    width: 100%;
    padding: 12px;
    border-radius: 12px;
    border: none;
    font-weight: 700;
    cursor: pointer;
}

.btn-primary {
    background: linear-gradient(135deg, #2563eb, #0a3d62);
    color: #fff;
}

.btn-success {
    background: #16a34a;
    color: #fff;
}

/* ================= PAGINATION ================= */
.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 16px;
    margin: 50px 0;
}

.pagination a,
.pagination span {
    padding: 10px 18px;
    border-radius: 10px;
    background: var(--primary);
    color: white;
    text-decoration: none;
    font-weight: 600;
}
.pagination span {
    background: transparent;
    color: inherit;
}

/* ================= MOBILE ================= */
@media (max-width: 600px) {
    .page-title {
        font-size: 24px;
    }
}
</style>

<h2 class="page-title">Explore Courses</h2>
<p class="page-subtitle">Find the best learning resources curated for you...</p>

<!-- FILTER BAR -->
<form method="get" action="{{ url_for('courses') }}" class="filter-bar">
    <div class="filter-grid">

        <input type="text" name="search" placeholder="Search courses..."
               value="{{ search }}">

        <select name="programming_language">
            <option value="">All Languages</option>
            <option value="Python" {{ 'selected' if selected_programming_language == 'Python' }}>Python</option>
            <option value="C" {{ 'selected' if selected_programming_language == 'C' }}>C</option>
            <option value="C++" {{ 'selected' if selected_programming_language == 'C++' }}>C++</option>
            <option value="Java" {{ 'selected' if selected_programming_language == 'Java' }}>Java</option>
            <option value="C#" {{ 'selected' if selected_programming_language == 'C#' }}>C#</option>
            <option value="GO" {{ 'selected' if selected_programming_language == 'GO' }}>GO</option>
        </select>

        <select name="difficulty">
            <option value="">All Levels</option>
            <option value="Beginner" {{ 'selected' if selected_difficulty == 'Beginner' }}>Beginner</option>
            <option value="Advanced" {{ 'selected' if selected_difficulty == 'Advanced' }}>Advanced</option>
        </select>

        <select name="source">
            <option value="">All Sources</option>
            <option value="YouTube" {{ 'selected' if selected_source == 'YouTube' }}>YouTube</option>
            <option value="Udemy" {{ 'selected' if selected_source == 'Udemy' }}>Udemy</option>
            <option value="Coursera" {{ 'selected' if selected_source == 'Coursera' }}>Coursera</option>
            <option value="FreeCodeCamp" {{ 'selected' if selected_source == 'FreeCodeCamp' }}>FreeCodeCamp</option>
            <option value="W3Schools" {{ 'selected' if selected_source == 'W3Schools' }}>W3Schools</option>
            <option value="GeeksforGeeks" {{ 'selected' if selected_source == 'GeeksforGeeks' }}>GeeksforGeeks</option>
        </select>

        <select name="sort">
            <option value="newest" {{ 'selected' if sort == 'newest' }}>Newest</option>
            <option value="popular" {{ 'selected' if sort == 'popular' }}>Most Popular</option>
        </select>

        <button type="submit">Apply Filters</button>
        <a href="{{ url_for('courses') }}" class="clear-btn">Clear</a>
    </div>
</form>

<!-- COURSES -->
<div class="course-container">
{% for course in courses %}
    <div class="course-card">

        {% if course.image_url %}
            {% if course.image_url.startswith('http') %}
                <img src="{{ course.image_url }}">
            {% else %}
                <img src="{{ url_for('static', filename='images/' ~ course.image_url) }}">
            {% endif %}
        {% else %}
            <img src="{{ url_for('static', filename='images/default-course.png') }}">
        {% endif %}

        <div class="course-content">
            <h3>{{ course.title }}</h3>
            <p>{{ course.description }}</p>

            <div class="badges">
                <span class="badge">{{ course.programming_language }}</span>
                <span class="badge">{{ course.difficulty }}</span>
                <span class="badge">{{ course.source }}</span>
            </div>

            {% if course.is_enrolled %}
                <button class="btn-success" disabled>Enrolled ✓</button>
            {% else %}
                <button class="btn-primary enroll-btn"
                        data-course-id="{{ course.id }}">
                    Enroll Now
                </button>
            {% endif %}
        </div>
    </div>
{% endfor %}
</div>

<!-- PAGINATION -->
<div class="pagination">
{% if page > 1 %}
    <a href="{{ url_for('courses', page=page-1, search=search,
        programming_language=selected_programming_language,
        difficulty=selected_difficulty, source=selected_source) }}">
        ← Previous
    </a>
{% endif %}

<span>Page {{ page }} of {{ total_pages }}</span>

{% if page < total_pages %}
    <a href="{{ url_for('courses', page=page+1, search=search,
        programming_language=selected_programming_language,
        difficulty=selected_difficulty, source=selected_source) }}">
        Next →
    </a>
{% endif %}
</div>

<!-- ENROLL AJAX -->
<script>
document.querySelectorAll(".enroll-btn").forEach(btn => {
    btn.addEventListener("click", function () {
        fetch(`/enroll/${this.dataset.courseId}`, { method: "POST" })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    window.location.href = "/my-enrollments";
                }
            });
    });
});
</script>

{% endblock %}
