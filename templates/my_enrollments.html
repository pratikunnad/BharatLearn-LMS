{% extends "base.html" %}
{% block content %}

<style>
/* ================= PAGE TITLE ================= */
.page-title {
    text-align: center;
    margin: 35px 0;
    font-size: 28px;
    font-weight: 700;
    color: #0a3d62;
}

body.dark .page-title {
    color: #60a5fa;
}

/* ================= GRID ================= */
.course-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 28px;
    padding-bottom: 40px;
}

/* ================= CARD ================= */
.course-card {
    background: #ffffff;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 14px 32px rgba(0,0,0,0.08);
    transition: transform 0.25s ease, box-shadow 0.25s ease;
    display: flex;
    flex-direction: column;
}

.course-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 20px 45px rgba(0,0,0,0.14);
}

body.dark .course-card {
    background: #020617;
    box-shadow: 0 14px 32px rgba(0,0,0,0.6);
}

/* ================= IMAGE ================= */
.course-card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
}

/* ================= BODY ================= */
.card-body {
    padding: 22px;
    display: flex;
    flex-direction: column;
    flex: 1;
}

/* ================= BADGES ================= */
.badge {
    width: fit-content;
    font-size: 12px;
    padding: 6px 14px;
    border-radius: 20px;
    font-weight: 600;
    margin-bottom: 12px;
}

.badge-enrolled {
    background: #22c55e;
    color: white;
}

.badge-completed {
    background: #2563eb;
    color: white;
}

/* ================= TEXT ================= */
.course-card h3 {
    font-size: 18px;
    margin-bottom: 8px;
    color: #0a3d62;
}

body.dark .course-card h3 {
    color: #60a5fa;
}

.course-card p {
    font-size: 14px;
    line-height: 1.5;
    color: #555;
    margin-bottom: 14px;
}

body.dark .course-card p {
    color: #cbd5f5;
}

.enroll-date {
    font-size: 13px;
    color: #64748b;
    margin-bottom: 18px;
}

/* ================= ACTIONS ================= */
.card-actions {
    margin-top: auto;
    display: grid;
    gap: 10px;
}

/* ================= BUTTONS ================= */
.visit-btn {
    text-align: center;
    padding: 11px;
    border-radius: 10px;
    background: linear-gradient(135deg, #2563eb, #0a3d62);
    color: white;
    font-size: 13px;
    font-weight: 600;
    text-decoration: none;
}

.btn-complete {
    padding: 10px;
    border-radius: 10px;
    border: none;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
}

/* BLUE = not completed */
.btn-complete.pending {
    background: #2563eb; /* blue */
    color: white;
}

/* GREEN = completed */
.btn-complete.done {
    background: #22c55e; /* green */
    color: white;
    cursor: not-allowed;
    opacity: 0.9;
}


.btn-danger {
    padding: 10px;
    border-radius: 10px;
    border: none;
    background: #dc2626;
    color: white;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
}

/* ================= EMPTY STATE ================= */
.empty {
    text-align: center;
    font-size: 16px;
    margin-top: 50px;
    color: #64748b;
}

/* ================= BACK BUTTON ================= */
.back-btn-wrapper {
    margin-top: 45px;
    text-align: center;
}

.back-btn {
    padding: 12px 30px;
    background: linear-gradient(135deg, #0a3d62, #2563eb);
    color: white;
    border-radius: 30px;
    font-weight: 600;
    text-decoration: none;
    display: inline-block;
}

.back-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.25);
}
</style>

<h2 class="page-title">üìö My Enrolled Courses</h2>

{% if courses %}
<div class="course-grid">
{% for course in courses %}
<div class="course-card">

    {% if course.image_url %}
        {% if course.image_url.startswith('http') %}
            <img src="{{ course.image_url }}">
        {% else %}
            <img src="{{ url_for('static', filename='images/' ~ course.image_url) }}">
        {% endif %}
    {% else %}
        <img src="{{ url_for('static', filename='images/default-course.png') }}">
    {% endif %}

    <div class="card-body">

        {% if course.completed %}
            <span class="badge badge-completed">‚úî Completed</span>
        {% else %}
            <span class="badge badge-enrolled">Enrolled</span>
        {% endif %}

        <h3>{{ course.title }}</h3>
        <p>{{ course.description }}</p>

        <div class="enroll-date">
            Enrolled on {{ course.enrolled_at.strftime("%d %b %Y") }}
        </div>

        <div class="card-actions">

            <a href="/learner/visit-course/{{ course.id }}" target="_blank" class="visit-btn">
                ‚ñ∂ Visit Course
            </a>

            <form method="POST"
                action="{{ url_for('mark_completed', enrollment_id=course.enrollment_id) }}">

                {% if course.completed %}
                    <!-- COMPLETED -->
                    <button
                        class="btn-complete {% if course.completed %}completed{% endif %}"
                        {% if course.completed %}disabled{% endif %}
                    >
                        ‚úî Completed
                    </button>
                {% else %}
                    <!-- NOT COMPLETED -->
                    <button class="btn-complete pending">
                        ‚úì Mark as Completed
                    </button>
                {% endif %}

            </form>

            <form method="POST"
                  action="{{ url_for('unenroll', course_id=course.id) }}"
                  onsubmit="return confirm('Unenroll from this course?');">
                <button class="btn-danger">Unenroll</button>
            </form>

        </div>
    </div>
</div>
{% endfor %}
</div>
{% else %}
<p class="empty">You have not enrolled in any courses yet üòï</p>
{% endif %}

<div class="back-btn-wrapper">
    <a href="/learner/dashboard" class="back-btn">‚Üê Back to Dashboard</a>
</div>

{% endblock %}
